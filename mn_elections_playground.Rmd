---
title: "mn_elections_playground"
author: "Luke Kolar"
date: "10/3/2020"
output: html_document
---

```{r}
library(tidyverse)

```

```{r}

elec.col.names <- c("state", "county_id", "precinct_name",
                    "office_id", "office_name", "district", 
                    "candidate_order_code", "candidate_name",
                    "suffix", "incumbent_code", "party_affiliation",
                    "num_precincts_reporting", "total_num_precincts_voting",
                    "candidate_votes", "candidate_percent_vote", "total_race_votes")

sb_2018 <- read.delim("2018_general_schoolboard.txt", 
  sep = ";", header = FALSE, col.names = elec.col.names)


dist.names <- c("Fairfax", "Gibbon", "Winthrop")

test <- sb_2018
           
           
           
# sd_code, elect_num, dist_name, dist_num, position        



isTRUE(grepl(test$office_name, "Fairfax", fixed = TRUE))

?grepl

sb_2018 %>% View()

test %>% 
  group_by(office_name, district_name) %>% 
  summarize(n = n())



# all precincts reporting?
sb_2018 %>% 
  mutate(test = num_precincts_reporting - total_num_precincts_voting) %>% 
  group_by(test) %>% 
  summarize(n = n())

# all non-partisan?
sb_2018 %>% 
  group_by(party_affiliation) %>% 
  summarize(n = n())

# no suffixes?
sb_2018 %>% 
  group_by(suffix) %>% 
  summarize(n = n())

# incumbent codes?
sb_2018 %>% 
  group_by(incumbent_code) %>% 
  summarize(n = n())

```


```{r}

elec.col.names <- c("state", "county_id", "precinct_name",
                    "office_id", "office_name", "district", 
                    "candidate_order_code", "candidate_name",
                    "suffix", "incumbent_code", "party_affiliation",
                    "num_precincts_reporting", "total_num_precincts_voting",
                    "candidate_votes", "candidate_percent_vote", "total_race_votes")

dist.names <- c("Fairfax", "Gibbon", "Winthrop")

# board_elections <- 
#   read_delim("https://electionresultsfiles.sos.state.mn.us/20181106/sdrace.txt", 
#   delim = ";", col_names = elec.col.names)

sb_2018 <- read.delim("2018_general_schoolboard.txt", 
  sep = ";", header = FALSE, col.names = elec.col.names)

sb_2018 %>% 
  select(office_name, candidate_name, total_num_precincts_voting,
         candidate_votes, candidate_percent_vote, total_race_votes) %>% 
  mutate(special = ifelse(grepl("Special", office_name), TRUE, FALSE)) %>% 
  mutate(office_name = str_remove(office_name, "Special Election for ")) %>% 
  mutate(position = ifelse(grepl("Position", office_name), 
                           str_match(office_name, "(?<=Position )[:digit:]*"), 
                           "at-large")) %>% 
  mutate(district = ifelse(grepl("District [[:digit:]]", office_name), 
                           str_match(office_name, "(?<=District )[:digit:]*"), 
                           ifelse(grepl("District", office_name), 
                                  str_match(office_name, 
                                            "(?<=Member ).*(?= District)"), NA))) %>% 
  mutate(elect = ifelse(grepl("Elect [[:digit:]]", office_name), 
                        str_match(office_name, "(?<=Elect )[:digit:]*"),
                        1)) %>% 
  mutate(sd = ifelse(grepl("ISD", office_name), 
                     paste0("ISD ", str_extract(office_name, "(?<=ISD #)[:digit:]*")),
                     ifelse(grepl("SSD", office_name), 
                            paste0("SSD ", str_extract(office_name, "(?<=SSD #)[:digit:]*")),
                            "none"))) %>% 
  group_by(office_name, sd, special, position, district, elect) %>%
  summarize(n = n()) %>% View
  
  


```



